os:
  - linux
  - osx

language: c
before_script:
  - psql -c 'create database jeremy;' -U postgres
script:
  - make CFLAGS="-fsanitize=address -fsanitize=undefined -fno-sanitize-recover=all" test
  - make test-cpp
  - make clean
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then make CFLAGS=-g valgrind; fi
addons:
  apt:
    packages:
      - apache2-utils
      - valgrind
      - libpq-dev
services:
  - postgresql
